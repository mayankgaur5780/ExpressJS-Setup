<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta charset="utf-8" />
        <link rel="icon" type="image/x-icon" href="/logo/favicon.ico" />
        <title><%= helper_fns.trans('admin_app_name') %> - <%= title %></title>
        <meta name="description" content="<%= helper_fns.trans('admin_app_name') %> - <%= title %>" />
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <link rel="stylesheet" href="/backend/bootstrap/css/bootstrap.min.css">
        <% if(getLocale() == 'ar') { %>
            <link rel="stylesheet" href="/backend/bootstrap/css/bootstrap-flipped.css">
            <link rel="stylesheet" href="/backend/bootstrap/css/bootstrap-rtl.css">
        <% } %>

        <link rel="stylesheet" href="/backend/plugins/font-awesome-4.7.0/css/font-awesome.css">
        <link rel="stylesheet" href="/backend/plugins/ionicons-2.0.1/css/ionicons.min.css">
        <link rel="stylesheet" href="/backend/plugins/datatables/dataTables.bootstrap.css">

        <% if(getLocale() == 'ar') { %>
            <link rel="stylesheet" href="/backend/dist/css/AdminLTE-rtl.min.css">
            <link rel="stylesheet" href="/backend/dist/css/skins/_all-skins-rtl.min.css">
        <% } else { %>
            <link rel="stylesheet" href="/backend/dist/css/AdminLTE.min.css">
            <link rel="stylesheet" href="/backend/dist/css/skins/_all-skins.min.css">
        <% } %>
        
        
        <link rel="stylesheet" href="/backend/plugins/iCheck/flat/blue.css">
        <link rel="stylesheet" href="/backend/plugins/morris/morris.css">
        <link rel="stylesheet" href="/backend/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
        <link rel="stylesheet" href="/backend/plugins/datepicker/datepicker3.css">
        <link rel="stylesheet" href="/backend/plugins/daterangepicker/daterangepicker.css">
        <link rel="stylesheet" href="/backend/plugins/timepicker/bootstrap-timepicker.min.css">
        <link rel="stylesheet" href="/backend/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
        <link rel="stylesheet" href="/backend/plugins/fancybox/fancybox.css">
        <link rel="stylesheet" href="/backend/plugins/summernote/summernote.css">
        <link rel="stylesheet" href="/backend/plugins/select2/select2.min.css">
        <link rel="stylesheet" href="/backend/plugins/sweetalert2/sweetalert2.min.css">
        <link rel="stylesheet" href="/backend/css/site.css">
        <link rel="stylesheet" href="/backend/css/custom.css">
        <link rel="stylesheet" href="/backend/plugins/star-rating-svg-master/src/css/star-rating-svg.css">
        <link rel="stylesheet" href="/backend/plugins/cropper/cropper.css">

        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
       
        <script src="/backend/plugins/jQuery/jquery-2.2.3.min.js"></script>
    </head>
    
    <body class="hold-transition skin-blue sidebar-mini <%= getLocale() %>_lang">
        <div class="se-pre-con"></div>
        
        <div class="wrapper">
            <!-- Header Container Start -->
            <%- include('../includes/header'); %>
        
            <!-- Left side column. contains the logo and sidebar -->
            <%- include('../includes/leftmenu'); %>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <%- body %>
            </div>
            <!-- /.content-wrapper -->
            
            <!-- Include Footer -->
            <%- include('../includes/footer'); %>
        </div>

        <script>
            const CURRENT_URL = '<%= PAGE_URL %>';
            const CURRENT_LANG = '<%= getLocale() %>';
        </script>
        <script src="/backend/plugins/jQueryUI/jquery-ui.min.js"></script>
        <script src="/backend/bootstrap/js/bootstrap.min.js"></script>
        <script src="/backend/js/modernizr-custom.js"></script>
        <script src="/backend/plugins/datatables/jquery.dataTables.min.js"></script>
        <script src="/backend/plugins/datatables/dataTables.bootstrap.min.js"></script>
        <script src="/backend/plugins/datatables/dataTables.buttons.min.js"></script>
        <script src="/backend/plugins/datatables/buttons.flash.min.js"></script>
        <script src="/backend/plugins/datatables/jszip.min.js"></script>
        <script src="/backend/plugins/datatables/vfs_fonts.js"></script>
        <script src="/backend/plugins/datatables/buttons.html5.min.js"></script>
        <script src="/backend/plugins/moment/moment.min.js"></script>
        <script src="/backend/plugins/moment/moment-with-locales.min.js"></script>
        <script src="/backend/plugins/moment/moment-timezone.min.js"></script>
        <script src="/backend/plugins/moment/moment-timezone-with-data.min.js"></script>
        <script src="/backend/plugins/daterangepicker/daterangepicker.js"></script>
        <script src="/backend/plugins/datepicker/bootstrap-datepicker.js"></script>
        <script src="/backend/plugins/timepicker/bootstrap-timepicker.min.js"></script>
        <script src="/backend/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
        <script src="/backend/plugins/summernote/summernote.js"></script>
        <script src="/backend/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <script src="/backend/plugins/fastclick/fastclick.js"></script>
        <script src="/backend/plugins/chartjs/Chart.min.js"></script>
        <script src="/backend/plugins/select2/select2.full.min.js"></script>
        <script src="/backend/plugins/sweetalert2/sweetalert2.all.min.js"></script>
        <script src="/backend/plugins/cropper/cropper.js"></script>
        <script src="/backend/plugins/star-rating-svg-master/src/jquery.star-rating-svg.js"></script>
        <script src="/backend/dist/js/app.min.js"></script>

        <div id="remote_model" class="modal fade" data-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content"></div>
            </div>
        </div>
        <div id="other_remote_model" class="modal fade" data-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content"></div>
            </div>
        </div>
        <div id="cropper_model" class="modal fade" data-backdrop="static">
            <div class="modal-dialog modal-lg">
                <div class="modal-content"></div>
            </div>
        </div>

        <script type="text/javascript">
            $(window).on('load', function() {
                // Animate loader off screen
                $(".se-pre-con").fadeOut("slow");
            });

            // <!-- Http Errors -->
            const ajax_errors = {
                http_not_connected: "<%= helper_fns.trans('http_not_connected') %>",
                request_forbidden: "<%= helper_fns.trans('request_forbidden') %>",
                not_found_request: "<%= helper_fns.trans('not_found_request') %>",
                session_expire: "<%= helper_fns.trans('session_expire') %>",
                service_unavailable: "<%= helper_fns.trans('service_unavailable') %>",
                parser_error: "<%= helper_fns.trans('parser_error') %>",
                request_timeout: "<%= helper_fns.trans('request_timeout') %>",
                request_abort: "<%= helper_fns.trans('request_abort') %>"
            };
    
            $.extend( true, $.fn.dataTable.defaults, {
                <% if(getLocale() == 'ar') { %>
                    language: {url: '/backend/plugins/datatables/arabic.json'},
                <% } %>
                scrollX: true,
                scrollCollapse: true,
                fixedColumns: true,
                stateSave: true,
                dom: 'lBfrtip',
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
                buttons: [
                    {
                        extend: 'csv', 
                        className: 'btn btn-sm btn-primary',
                        text: function ( dt, button, config ) {
                            return dt.i18n('buttons.csv', '<i class="fa fa-file-o fa-fw"></i> <%= helper_fns.trans("csv") %>');
                        }
                    },
                    {
                        extend: 'excel', 
                        className: 'btn btn-sm btn-primary',
                        text: function ( dt, button, config ) {
                            return dt.i18n('buttons.csv', '<i class="fa fa-file-excel-o fa-fw"></i> <%= helper_fns.trans("excel") %>');
                        }
                    }
                ]
            });
            
            $(document).on('click', 'a[data-toggle="modal"]', function (e) {
                e.preventDefault();
                e.stopPropagation();

                var target_element = $(this).data('target');
                $(target_element).find('.modal-content').html(`
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12 center"><%= helper_fns.trans("loader_message") %></div>
                        </div>
                    </div>
                `);
            });
            
            $('#remote_model,#other_remote_model,#cropper_model').on('hidden.bs.modal', function (e) {
                $(this).removeData();
                $(this).find('.modal-content').empty();
            });
            // $('#remote_model').on('show.bs.modal', function (e) {});
            
            // For Image Cropper 
            $(document).on('change', '.image-cropper', function (e) {
                if (this.files && this.files[0]) {
                    let file = this.files[0];
                    let _URL = window.URL || window.webkitURL;
                    
                    let { width, height, name, enable_ratio } = $(this).data();
                    enable_ratio = enable_ratio === undefined ? 1 : enable_ratio;
                    let filename = $(this).val();
                    let extension = filename.substr((filename.lastIndexOf('.') + 1)).toLowerCase();
                    if($.inArray(extension, ['jpg', 'jpeg', 'png']) < 0) {
                        infoAlert('<%= helper_fns.trans("invalid_file_type") %>');
                        return false;
                    }
                    
                    // Validate image dimensions
                    let img = new Image();
                    img.onload = function () {
                        if(this.width < width || this.height < height) {
                            infoAlert('<%= helper_fns.trans("invalid_file_dimension") %>');
                            return false;
                        }

                        var reader = new FileReader();
                        reader.onload = function (e) {
                            $('#cropper_model .modal-content').data('crop_img', e.target.result);
                            $('#cropper_model').modal({show:true, remote: `{{ URL::to("admin/cropper/init") }}/${width}/${height}/${name}/${enable_ratio}`});
                        }
                        reader.readAsDataURL(file);
                    };
                    img.src = _URL.createObjectURL(file);
                }
            });

            $(document).on('click', '.delete-entry', async function(e) {
                e.preventDefault();

                if (await confirmAlert()) {
                    var href = $(this).attr('href');
                    var { tbl, reload_page } = $(this).data();
                    $.get( href, () => {
                        if (reload_page == 1) {
                            location.reload(true);
                        } else {
                            reloadTable(`${tbl}-table`);
                        }
                    })
                    .fail((jqXHR, exception) => infoAlert($(formatErrorMessage(jqXHR, exception)).text()));
                }
            });

            // await confirmAlert()
            async function confirmAlert() {
                let { value: isAccepted } = await Swal.fire({
                    text: `<%= helper_fns.trans('are_you_sure') %>`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: `<i class="fa fa-check"></i> <%= helper_fns.trans('yes') %>`,
                    cancelButtonText: `<%= helper_fns.trans('cancel') %>`,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                });
                return isAccepted === true;
            }

            async function infoAlert(msg, icon = 'warning') {
                await Swal.fire({
                    text: msg,
                    icon, // warning, error, success, info, and question
                    showCancelButton: false,
                    confirmButtonText: `<i class="fa fa-check"></i> <%= helper_fns.trans('okay') %>`,
                    confirmButtonColor: '#3085d6',
                });
            }
        </script>

        <script src="/backend/js/main.js"></script>
    </body>
</html>